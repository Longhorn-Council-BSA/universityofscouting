<html>
  <header>
    <title>Member Schedule</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Enable jquery features -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      .btn + .disabled { cursor: not-allowed;}
      .header{margin-top: 20px;}
      tr th, tr td, td input{text-align: center;}
      tr th, tr td{ width: 20%;}
      td button { width: 50px;}
      .loader {border: 8px solid #a4a7a8; border-radius: 50%; border-top: 8px solid #CE1126; width: 30px; height: 30px; -webkit-animation: spin 2s linear infinite; animation: spin 2s linear infinite; margin: 0px auto 0px 0px;}
      .loader2 {margin: 0px auto; border: 18px solid #a4a7a8; border-top: 18px solid #CE1126; width: 120px; height: 120px;}
      @-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); }}
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); }}
    </style>
  </header>
  <body>
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="header text-center">
            <h1>University of Scouting Transcript</h1>
            <h4><span id="name"></span></h4>
            Member ID: <span id="userID"></span> 
            | <span id="rowCount"></span> Records
          </div>
          <table class="mx-auto table table-sm">
            <thead>
              <tr>
                <th>Course Date</th>
                <th>Course Title</th>
                <th>Credits</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tbody">
            </tbody>
          </table>
          <div class="loader loader2"></div>
        </div>
      </div>
    </div>
    <datalist id="statusOptions">
      <option value="-">
      <option value="Completed">
      <option value="In Progress">
      <option value="Withdrawn">
    </datalist>
  </body>
  <script>
    $("document").ready(function(){
      var getUrlParameter = function getUrlParameter(sParam) {
      var sPageURL = window.location.search.substring(1), sURLVariables = sPageURL.split('&'), sParameterName, i;
      for (i = 0; i < sURLVariables.length; i++) {
          sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] === sParam) {
              return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
          }
        }
      };
      var id = getUrlParameter('memberID');
      getSchedule(id);
    });
    // -----------------------------------------------------------------------------------------//
    function getSchedule(id){
      $(".loader").css("visibility","initial");
      $('#userID').html(id)
      $.ajax({
        dataType: "json",
        url: "/api/transcripts",
        data: {memberData: true, memberID: id},
        success:  function(data){
          if(data.length > 0){
            $('#name').text(data[0].firstName+' '+data[0].lastName);
            $("#tbody").html("");
            $("#rowCount").html(data.length);
            for(var i = 0; i < data.length; i++){
              if(data[i].credits == undefined){data[i].credits = '-';}
              var todayTime = new Date(data[i].date);
              var month = todayTime .getMonth() + 1;
              var day = todayTime .getDate();
              var year = todayTime .getFullYear();
              var DATE = month + "/" + day + "/" + year;
              $("#tbody").append('<tr id="row'+i+'"><td id="DATE'+i+'" date-data="'+data[i].date+'">'+DATE+'</td><td id="TITLE'+i+'">'+data[i].title+'</td><td id="CREDITS'+i+'">'+data[i].credits+'</td><td id="STATUS'+i+'">'+data[i].status+'</td><td style="width:16%;"><button id="Edit'+i+'" class="btn btn-sm btn-primary" onClick="enableEdit('+i+')">Edit</button><button id="Save'+i+'" class="btn btn-sm btn-success" style="display:none;" onClick="saveTranscriptRecord('+i+')">Save</button><button id="Del'+i+'" class="btn btn-sm btn-danger disabled" onClick="deleteTranscriptRecord('+i+')" disabled>Del</button></td></tr>');
            }
            $(".loader").css("visibility","hidden");
          }else{
            $("#rowCount").html(data.length);
            $("#tbody").append('<tr><td colspan="4"><h4 style="color:#CE1126;text-align:center;"><strong>'+data.length+' records returned for member ID '+id+'</strong></h4></td></tr>');
            $(".loader").css("visibility","hidden");
          }
        }
      });
    }
    // -----------------------------------------------------------------------------------------//
    function enableEdit(i){
      $('#DATE'+i).html('<input id="inputDate'+i+'" type="date" value="'+$('#DATE'+i).attr('date-data')+'"/>');
      $('#TITLE'+i).html('<input id="inputTitle'+i+'" type="text" value="'+$('#TITLE'+i).text()+'"/>');
      $('#CREDITS'+i).html('<input id="inputCredits'+i+'" type="number" value="'+$('#CREDITS'+i).text()+'"/>');
      $('#STATUS'+i).html('<input id="inputStatus'+i+'" list="statusOptions" value="'+$('#STATUS'+i).text()+'"/>');
      $('#Edit'+i).css('display', 'none');
      $('#Save'+i).css('display', 'initial');
      $('#Del'+i).removeClass('disabled').attr("disabled", false);
    }
    function saveTranscriptRecord(i){
      var date = $('#inputDate'+i).val();
      var todayTime = new Date(date);
      var month = todayTime .getMonth() + 1;
      var day = todayTime .getDate();
      var year = todayTime .getFullYear();
      var DATE = month + "/" + day + "/" + year;
      $('#DATE'+i).html(DATE);
      $('#TITLE'+i).html($('#inputTitle'+i).val());
      var CREDITS = $('#inputCredits'+i).val();
      if(CREDITS == ""){CREDITS = "-"}
      $('#CREDITS'+i).html(CREDITS);
      $('#STATUS'+i).html($('#inputStatus'+i).val());
      $('#Edit'+i).css('display', 'initial');
      $('#Save'+i).css('display', 'none');
      $('#Del'+i).removeClass('disabled').attr("disabled", true);
    }
    function deleteTranscriptRecord(i){
      $('#row'+i).toggle(function() {$(this).animate({ color: "#FF0000" }, 1000);});
    }
  </script>
</html>