<%- include header %>
  <div class="container main-body">
    <div class="row">
      <div class="col-12">
        <div class="row">
          <div class="col-1">
          </div>
          <div class="col-10 text-center">
            <button onclick="downloadCSV()" class="btn btn-sm btn-3">Download CSV</button>
            <button onclick="downloadPDF()" class="btn btn-sm btn-3">Download PDF</button>
            <button onclick="print()" class="btn btn-sm btn-3">Print</button>
          </div>
          <div class="col-1"></div>
       </div>
        <div id="transcriptTableDiv">
          <table id="transcriptTable" class="mx-auto table table-hover table-sm table-bordered transcript text-center">
            <thead class="thead-dark">
              <!-- <th>Index</th> -->
              <th>Member ID</th>
              <th>Course Date</th>
              <th>Course Title</th>
              <th>Credits</th>
              <th>Status</th>
              <!-- <th class="noprint"></th> -->
            </thead>
            <tbody>
              <% for(var i=0; i<transcript.length; i++) { var index = i+1 %>
              <tr>
                <!-- <td class="text-center"><%= index %></td> -->
                <td><%= transcript[i].memberID %></td>
                <td><%= transcript[i].date %></td>
                <td><%= transcript[i].title %></td>
                <td><%= transcript[i].credits %></td>
                <td><%= transcript[i].status %></td>
                <!-- <td class="noprint text-center"><button class="btn btn-sm btn-warning" id="">Edit (<%= index %>)</button></td> -->
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <img id="watermark" src="http://localhost:3000/images/LHC_UoS_Logo_Watermark.png" style="display: none; height: 800px; width: 600px;"/>
<%- include footer %>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
<script>
  
  function downloadPDF() {
    var numRows = document.getElementById("transcriptTable").rows.length;
    var height = numRows * 0.28;
    $('#watermark').css('display','initial');
    html2canvas(document.getElementById('watermark'), { allowTaint: true }).then(
      function(canvas) {
        var imgData = canvas.toDataURL("image/png", 1.0);
        pdf = new jsPDF({ orientation: 'portrait', unit: 'in'});-
        pdf.addImage(imgData, 'JPG', 1.5, 1, 5, 8); //(imgData, image format, left margin, top margin, img width, img hight)
        html2canvas(
          document.getElementById('transcriptTable'), { allowTaint: true }).then(
            function(canvas) {
              var imgData = canvas.toDataURL("image/png", 1.0);
              pdf.addImage(imgData, 'JPG', 1.5, 1.5, 5, height); //(imgData, image format, left margin, top margin, img width, img hight)
              pdf.save();
            }
          );
        }
      );
    $('#watermark').css('display','none');
  }
  
  function downloadCSV() {
    document.querySelector(".buttons-csv").click()
  }

  function print() {
    var sTable = document.getElementById('transcriptTableDiv').innerHTML;
    var icon = document.getElementById('Icon');
    var style = "<style>";
    style += "body{ background-image: url('http://localhost:3000/images/LHC_UoS_Logo_Watermark.png'); background-position: center;background-repeat: no-repeat; background-size: 600px 800px;}"
    style += "table {max-width: 80%; font: 10px Calibri; margin:0 auto; margin-top:50px; white-space: nowrap;}";
    style += "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
    style += "padding: 2px 3px;text-align: center;} td{ vertical-align: middle;}";
    style += ".title{text-align:center; margin:0 auto; margin-top:50px;}"
    style += ".noprint { display:none;}"
    style += "</style>";
    // CREATE A WINDOW OBJECT.
    var win = window.open('', '', 'height=700,width=900, copyhistory=no');
    win.document.write('<html><head><title>Transcript</title>'+style+'</head><body id="transcriptTableDiv"><h1 class="title">University of Scouting Transcript</h1>'+sTable+'</body></html>');
    win.document.close(); 	// CLOSE THE CURRENT WINDOW.
    win.print();    // PRINT THE CONTENTS.
  }
  
  $(document).ready(
    function() {
      $('#transcriptTable').DataTable( {dom: 'Bfrtip',buttons: ['csvHtml5']});
    }
  );
  
  $(document).ready(
    function() {
      $('.dt-button').addClass('btn btn-sm btn-2');
      $('.buttons-csv').css('display','none');
      $('#transcriptTable_filter').css('display','none');
      $('#transcriptTable_info').css('display','none');
      $('#transcriptTable_paginate').css('display','none');
    }
  );
</script>